<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Hand Particle AR</title>
  <style>
    body { margin:0; overflow:hidden; background:black; }
    video { display:none; }
  </style>
</head>
<body>

<video id="video" autoplay playsinline></video>

<!-- THREE.JS -->
<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/examples/js/postprocessing/EffectComposer.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/examples/js/postprocessing/RenderPass.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/examples/js/postprocessing/UnrealBloomPass.js"></script>

<!-- MEDIAPIPE -->
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>

<script>
/* ================= SCENE ================= */
const scene = new THREE.Scene();

const camera = new THREE.PerspectiveCamera(
  75,
  window.innerWidth / window.innerHeight,
  0.1,
  1000
);
camera.position.z = 80;

const renderer = new THREE.WebGLRenderer({ alpha:true, antialias:true });
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

/* ================= BLOOM ================= */
const composer = new THREE.EffectComposer(renderer);
composer.addPass(new THREE.RenderPass(scene, camera));
composer.addPass(
  new THREE.UnrealBloomPass(
    new THREE.Vector2(window.innerWidth, window.innerHeight),
    1.5, 0.4, 0.85
  )
);

/* ================= PARTICLES ================= */
const COUNT = 1500;
const geo = new THREE.BufferGeometry();
const pos = new Float32Array(COUNT * 3);

function createParticles(){
  for(let i=0;i<COUNT;i++){
    pos[i*3]   = (Math.random()-0.5)*30;
    pos[i*3+1] = (Math.random()-0.5)*30;
    pos[i*3+2] = (Math.random()-0.5)*30;
  }
  geo.setAttribute("position", new THREE.BufferAttribute(pos,3));
}
createParticles();

const mat = new THREE.PointsMaterial({
  size: 1.6,
  color: 0xff55ff,
  transparent:true
});

const pts = new THREE.Points(geo, mat);
pts.position.z = -30;
scene.add(pts);

/* ================= HAND TRACKING ================= */
const hands = new Hands({
  locateFile: f => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${f}`
});

hands.setOptions({
  maxNumHands: 1,
  minDetectionConfidence: 0.6,
  minTrackingConfidence: 0.6
});

hands.onResults(r=>{
  if(!r.multiHandLandmarks || r.multiHandLandmarks.length===0) return;

  const h = r.multiHandLandmarks[0];

  // ðŸ‘‰ Palm center (landmark 9)
  const palmX = (h[9].x - 0.5) * window.innerWidth;
  const palmY = -(h[9].y - 0.5) * window.innerHeight;

  pts.position.x = palmX * 0.1;
  pts.position.y = palmY * 0.1;

  // Thumb â€“ Index distance
  const d = Math.hypot(
    h[8].x - h[4].x,
    h[8].y - h[4].y
  );

  // Scale + Color
  pts.scale.setScalar(1 + d * 4);
  mat.color.setHSL(d * 3, 1, 0.6);

  // Pinch = blast
  if(d < 0.04) createParticles();
});

/* ================= CAMERA ================= */
const video = document.getElementById("video");
const cam = new Camera(video, {
  onFrame: async () => {
    await hands.send({ image: video });
  },
  width: 640,
  height: 480
});
cam.start();

/* ================= LOOP ================= */
function animate(){
  requestAnimationFrame(animate);
  composer.render();
}
animate();
</script>

</body>
</html>
